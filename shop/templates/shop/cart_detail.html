{% extends 'shop/base.html' %}
{% load static %}

{% block title %}Your Cart - TechMart{% endblock %}

{% block extra_css %}
<style>
    :root {
        --maroon-1: rgb(81, 34, 50);
        --maroon-2: rgb(81, 34, 50);
        --border-dark: rgb(78, 46, 56);
        --card-bg: rgba(255, 255, 255, 0.05);
        --card-bg-weak: rgba(255, 255, 255, 0.03);
        --text-dim: rgba(255,255,255,0.85);
    }

    body { background: #000; color: #fff; }

    .cart-page { padding: 40px 20px; }
    .cart-container {
        background: var(--card-bg);
        border: 1px solid var(--border-dark);
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        max-width: 1000px;
        margin: 30px auto;
        padding: 28px;
    }
    .cart-title { text-align:center; font-size: 2.2rem; font-weight: 300; margin-bottom: 24px; }

    .cart-table { width:100%; border-collapse: collapse; margin-bottom: 24px; border-radius: 14px; overflow:hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.35); }
    .cart-table th { background: linear-gradient(135deg, var(--maroon-1), var(--maroon-2)); color:#fff; padding:14px 10px; }
    .cart-table td { padding:14px 10px; text-align:center; border-bottom: 1px solid rgba(255,255,255,0.08); color: var(--text-dim); }
    .cart-table tr:hover { background: rgba(255,255,255,0.03); }
    .cart-table img { width:72px; height:72px; border-radius:10px; object-fit:cover; box-shadow: 0 3px 10px rgba(0,0,0,0.35); }

    .cart-total { background: var(--card-bg-weak); border:1px solid var(--border-dark); border-radius: 14px; padding: 16px; margin: 16px 0 8px; }
    .totals-row { display:flex; justify-content: space-between; padding:6px 0; }
    .totals-row.muted { color: var(--text-dim); }
    .totals-row.final { border-top: 2px solid var(--border-dark); margin-top:8px; padding-top:12px; font-size:1.2rem; font-weight:700; color:#fff; }

    /* Actions */
    .actions { display:flex; gap:14px; align-items:center; justify-content:flex-end; margin-top: 16px; }
    .checkout-btn {
        background: linear-gradient(135deg, var(--maroon-1), var(--maroon-2));
        color:#fff; border:1px solid var(--border-dark);
        padding: 12px 26px; border-radius: 26px; text-decoration:none; font-weight:600;
        transition: transform .2s ease, box-shadow .2s ease; white-space: nowrap;
    }
    .checkout-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(172,59,84,0.35); }

    /* Minimal back link (no big border, no large space) */
    .back-link { color: var(--maroon-2); text-decoration:none; font-weight:600; padding:0; border:none; background:none; }
    .back-link:hover { text-decoration: underline; }

    .quantity-input { width: 60px; padding: 8px; border: 2px solid var(--border-dark); background:#0f0f0f; color:#fff; border-radius:8px; text-align:center; }
    .update-btn { background: linear-gradient(135deg, var(--maroon-1), var(--maroon-2)); color:#fff; border:none; padding:8px 12px; border-radius:8px; font-size:12px; }
    .remove-btn { background: linear-gradient(135deg, rgb(120,24,24), rgb(168,34,34)); color:#fff; border:none; padding:8px 12px; border-radius:8px; font-size:12px; }

    @media (max-width: 768px) {
        .cart-container { padding: 18px; }
        .cart-table img { width:56px; height:56px; }
        .actions { flex-direction: column; align-items: flex-start; gap: 10px; }
    }
</style>
{% endblock %}

{% block content %}
<section class="cart-page">
    <div class="cart-container">
        <div class="cart-title">Your Shopping Cart</div>

        {% if cart.items %}
        <table class="cart-table">
            <tr>
                <th>Product</th>
                <th>Image</th>
                <th>Price</th>
                <th>Quantity</th>
                <th>Subtotal</th>
                <th>Actions</th>
            </tr>
            {% for item in cart.items %}
            <tr>
                <td>
                    <strong>{{ item.product.name }}</strong>
                    {% if item.variant %}<br>
                        <small style="color: var(--text-dim);">Color: {{ item.variant.color_name }} | Size: {{ item.size.size }}</small>
                    {% endif %}
                </td>
                <td>
                    {% if item.variant and item.variant.image_url %}
                        <img src="{{ item.variant.image_url }}" alt="{{ item.product.name }}">
                    {% elif item.product.image_url %}
                        <img src="{{ item.product.image_url }}" alt="{{ item.product.name }}">
                    {% else %}
                        <div style="width:72px;height:72px;background:#111;border:1px solid var(--border-dark);border-radius:10px;display:flex;align-items:center;justify-content:center;color:#777;">üì¶</div>
                    {% endif %}
                </td>
                <td>{% if item.variant %}<strong>OMR {{ item.variant.price }}</strong>{% else %}<strong>OMR {{ item.product.price }}</strong>{% endif %}</td>
                <td>
                    <form action="{% url 'update_cart_quantity' item.cart_key %}" method="post" style="display:inline;">
                        {% csrf_token %}
                        <input type="number" name="quantity" value="{{ item.quantity }}" min="1" class="quantity-input">
                        <button type="submit" class="update-btn">Update</button>
                    </form>
                </td>
                <td><strong>OMR {{ item.total_price }}</strong></td>
                <td>
                    <form action="{% url 'remove_from_cart' item.cart_key %}" method="post" style="margin:0;">
                        {% csrf_token %}
                        <button type="submit" class="remove-btn">Remove</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </table>

        <div class="cart-total">
            <div class="totals-row muted">
                <span>Subtotal:</span>
                <span>OMR {{ cart.total_price }}</span>
            </div>
            <div class="totals-row muted">
                <span>Delivery Fee:</span>
                <span>{% if cart.delivery_fee > 0 %}OMR {{ cart.delivery_fee }}{% else %}FREE{% endif %}</span>
            </div>
            <div class="totals-row final">
                <span>Total:</span>
                <span>OMR {{ cart.final_total }}</span>
            </div>
        </div>

        <div class="actions">
            <a href="{% url 'home' %}" class="back-link">‚Üê Back to Shopping</a>
            <a href="{% url 'checkout' %}" class="checkout-btn">Proceed to Checkout</a>
        </div>

        {% else %}
        <div class="cart-total" style="text-align:center;">
            <h3 style="margin:0 0 8px 0;">Your cart is empty</h3>
            <p style="color:var(--text-dim);margin:0 0 12px 0;">Add some products to get started!</p>
            <a href="{% url 'home' %}" class="back-link">‚Üê Back to Shopping</a>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}
