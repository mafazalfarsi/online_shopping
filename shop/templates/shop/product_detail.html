{% extends 'shop/base.html' %}

{% block title %}{{ product.name }} - TechMart{% endblock %}

{% block extra_css %}
<style>
  /* Background to match product list */
  html, body {
      background: linear-gradient(135deg, rgb(0, 0, 0) 0%, rgb(0, 0, 0) 50%, rgb(0, 0, 0) 100%) !important;
  }

  .search-container {
      max-width: 500px; margin: 20px auto; padding: 0 20px;
  }
  /* Uiverse search - burgundy theme */
  .form button { border: none; background: none; color: #8b8ba7; }
  .form { --timing: .3s; --width-of-input: 500px; --height-of-input: 48px; --border-height: 2px; --input-bg: rgba(0,0,0,.5); --border-color: rgb(112,0,28); --border-radius: 30px; --after-border-radius: 10px; position: relative; width: var(--width-of-input); height: var(--height-of-input); display:flex; align-items:center; padding-inline:.8em; border-radius: var(--border-radius); transition: border-radius .5s ease; background: linear-gradient(135deg, rgba(255,255,255,.06) 0%, rgba(139,0,46,.25) 100%); backdrop-filter: blur(10px); border:1px solid rgba(255,255,255,.25); }
  .input { font-size:1rem; background:transparent; width:100%; height:100%; padding-inline:.5em; padding-block:.7em; border:none; color:#fff; }
  .input::placeholder { color: rgba(255,255,255,.8); }
  /* remove animated bottom border */
  .form:before { display:none !important; }
  .form:focus-within { border-radius: var(--after-border-radius); }
  .form:focus-within:before { display:none; }
  .reset { border:none; background:none; opacity:0; visibility:hidden; color:#fff; }
  .form input:not(:placeholder-shown) ~ .reset { opacity:1; visibility:visible; }
  .form svg { width:17px; margin-top:3px; color:#fff; }
  /* remove white focus ring */
  .form, .form * { outline: none !important; box-shadow: none !important; }

        .product-container {
            max-width: 800px;
            margin: 40px auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .product-header {
            background: linear-gradient(135deg,#512232 0%,#512232 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .product-header h1 {
            margin: 0;
            font-size: 2.2em;
            font-weight: 300;
        }

        .product-content {
            padding: 40px;
        }

        .product-main {
            display: flex;
            gap: 40px;
            margin-bottom: 40px;
        }

        .product-image-section {
            flex: 0 0 350px;
        }

        .product-info-section {
            flex: 1;
        }

        .product-image {
            text-align: center;
            margin-bottom: 30px;
        }

        .product-image img {
            max-width: 300px;
            max-height: 300px;
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .product-details-sections {
            border-top: 2px solid #f0f0f0;
            padding-top: 30px;
        }

        .detail-section {
            margin-bottom: 30px;
        }

        .detail-section h3 {
            color: #333;
            font-size: 1.4em;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .detail-section p {
            color: #666;
            line-height: 1.6;
            font-size: 1em;
        }

        .features-list {
            list-style: none;
            padding: 0;
        }

        .features-list li {
            padding: 8px 0;
            color: #666;
            position: relative;
            padding-left: 25px;
        }

        .features-list li:before {
            content: "‚úì";
            color: #28a745;
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        .specs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .spec-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #512232;
        }

        .spec-label { font-weight: 600; color: #333; }
        .spec-value { color: #666; }

        .shipping-info { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .shipping-item { display:flex; align-items:center; gap:15px; padding:20px; background:#512232; border-radius:10px; border:1px solid rgba(255,255,255,0.15); }
        .shipping-item strong { color:#ffffff; display:block; margin-bottom: 5px; }
        .shipping-item p { color:rgba(255,255,255,0.9); margin:0; font-size:0.95em; }

        .product-details { margin-bottom: 30px; }
        .product-price { font-size: 2em; font-weight: bold; color: #000; margin-bottom: 15px; }
        .product-description { font-size: 1.1em; line-height: 1.6; color: #555; margin-bottom: 20px; }
        .product-category { background:#f8f9fa; padding:10px 15px; border-radius:8px; display:inline-block; color:#000; font-weight:600; }

        .button-group { display:flex; gap:12px; justify-content:flex-start; margin-top:30px; flex-direction: column; align-items: flex-start; }
        .btn { padding:12px 30px; border:none; border-radius:8px; font-size:16px; font-weight:600; cursor:pointer; transition: all .3s ease; text-decoration:none; display:inline-block; text-align:center; }
        .btn-primary { background:#000; color:#fff; }
        .btn-primary:hover { background:#5a5a5a; }
        .btn-secondary { background:transparent; color:#fff; }
        .btn-secondary:hover { color:#ddd; }
        .btn-success { background:#512232; color:#fff; }
        .btn-success:hover { background:#633047; transform: translateY(-2px); }

        /* Back link (match list page) */
        .back-btn {
            display: inline-block;
            color: white;
            text-decoration: none;
            font-weight: 500;
            margin: 0 0 20px 0;
            opacity: 0.9;
        }
        .back-btn:hover { opacity: 1; text-decoration: underline; }

        /* Cart hover feedback */
        .btn-cart.feedback { transform: scale(1.1); box-shadow: 0 0 0 3px rgba(172,59,84,.4); }
</style>
{% endblock %}

{% block content %}
    <div class="search-container">
        <form method="GET" action="{% url 'search_products' %}" class="form" novalidate>
            <button type="submit" aria-label="Search">
                <svg width="17" height="16" fill="none" xmlns="http://www.w3.org/2000/svg" role="img" aria-labelledby="search">
                    <path d="M7.667 12.667A5.333 5.333 0 107.667 2a5.333 5.333 0 000 10.667zM14.334 14l-2.9-2.9" stroke="currentColor" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
            </button>
            <input class="input" name="q" placeholder="Search for products..." type="text">
            <button class="reset" type="reset" aria-label="Clear">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </form>
    </div>

    <div class="back-wrap" style="width:100%;padding:0 20px 10px 20px;text-align:left;">
        <a href="javascript:history.back()" class="back-btn">‚Üê Back to Categories</a>
    </div>
    <div class="product-container">
        <div class="product-header">
            <h1>{{ product.name }}</h1>
        </div>

        <div class="product-content">
            <div class="product-main">
                <div class="product-image-section">
            {% if product.image_url %}
                <div class="product-image">
                    <img src="{{ product.image_url }}" alt="{{ product.name }}">
                </div>
                    {% else %}
                        <div class="product-image-placeholder">
                            <div style="width: 300px; height: 300px; background: #f5f5f5; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 4em; color: #ccc;">üì¶</div>
                        </div>
            {% endif %}
                </div>

                <div class="product-info-section">
            <div class="product-details">
                <div class="product-price">OMR {{ product.price }}</div>
                <div class="product-description">{{ product.description }}</div>
                {% if product.category %}
                <div class="product-category">Category: {{ product.category.name }}</div>
                {% endif %}
            </div>

            <div class="button-group">
                <form id="add-to-cart-form" action="{% url 'add_to_cart' %}" method="post" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" name="product_id" value="{{ product.id }}">
                    <button type="submit" class="btn btn-success">Add to Cart</button>
                </form>
                {% if request.session.is_admin %}
                <a href="{% url 'edit_product' product.id %}" class="btn btn-primary">Edit Product</a>
                {% endif %}

                    </div>
                </div>
            </div>

            <div class="product-details-sections">
                <div class="detail-section">
                    <h3>About This Product</h3>
                    <p>{{ product.about_product|default:product.description|default:"Experience premium quality and innovative design with this exceptional product. Crafted with attention to detail and built to last, this item combines style and functionality to meet your needs." }}</p>
                </div>

                <div class="detail-section">
                    <h3>Key Features</h3>
                    {% if product.key_features %}
                        <ul class="features-list">
                            {% for feature in product.key_features.splitlines %}
                                {% if feature.strip %}
                                    <li>{{ feature.strip }}</li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    {% else %}
                        <ul class="features-list">
                            <li>High-quality materials and construction</li>
                            <li>Modern design and aesthetics</li>
                            <li>Durable and long-lasting</li>
                            <li>User-friendly and intuitive</li>
                        </ul>
                    {% endif %}
                </div>

                <div class="detail-section">
                    <h3>Specifications</h3>
                    <div class="specs-grid">
                        <div class="spec-item">
                            <span class="spec-label">Brand:</span>
                            <span class="spec-value">{{ product.brand|default:"TechMart" }}</span>
                        </div>
                        <div class="spec-item">
                            <span class="spec-label">Category:</span>
                            <span class="spec-value">{{ product.category.name|default:"Electronics" }}</span>
                        </div>
                        <div class="spec-item">
                            <span class="spec-label">Warranty:</span>
                            <span class="spec-value">{{ product.warranty|default:"1 Year" }}</span>
                        </div>
                        <div class="spec-item">
                            <span class="spec-label">Availability:</span>
                            <span class="spec-value">{{ product.availability|default:"In Stock" }}</span>
                        </div>
                        {% if specifications %}
                            {% for spec in specifications %}
                                <div class="spec-item">
                                    <span class="spec-label">{{ spec.label }}:</span>
                                    <span class="spec-value">{{ spec.value }}</span>
                                </div>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>

                <div class="detail-section">
                    <h3>Shipping & Returns</h3>
                    <div class="shipping-info">
                        <div class="shipping-item">
                            <div>
                                <strong>Free Delivery</strong>
                                <p>For orders over 70 OMR</p>
                            </div>
                        </div>
                        <div class="shipping-item">
                            <div>
                                <strong>60 Days Return</strong>
                                <p>If goods have problems</p>
                            </div>
                        </div>
                        <div class="shipping-item">
                            <div>
                                <strong>Secure Payment</strong>
                                <p>100% secure payment</p>
                            </div>
                        </div>
                        <div class="shipping-item">
                            <div>
                                <strong>1 Year Warranty</strong>
                                <p>Manufacturer warranty on eligible items</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
<script>
// AJAX add-to-cart and navbar cart feedback
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('add-to-cart-form');
  if (!form) return;
  form.addEventListener('submit', async function(e) {
    e.preventDefault();
    const formData = new FormData(form);
    const csrf = form.querySelector('input[name="csrfmiddlewaretoken"]').value;
    try {
      const resp = await fetch(form.action, {
        method: 'POST',
        headers: { 'X-Requested-With': 'XMLHttpRequest', 'X-CSRFToken': csrf },
        body: formData
      });
      const data = await resp.json();
      if (data && data.success) {
        // Update navbar cart badge
        const cartBtn = document.querySelector('.btn-cart');
        if (cartBtn) {
          cartBtn.setAttribute('data-quantity', data.cart_quantity);
          const qSpan = cartBtn.querySelector('.quantity');
          if (qSpan) { qSpan.textContent = data.cart_quantity; qSpan.style.display = data.cart_quantity > 0 ? 'block' : 'none'; }
          // Simulate hover feedback briefly
          cartBtn.classList.add('feedback');
          const icon = cartBtn.querySelector('.icon-cart');
          if (icon) icon.style.transform = 'scale(1.2)';
          setTimeout(() => {
            cartBtn.classList.remove('feedback');
            if (icon) icon.style.transform = '';
          }, 900);
        }

      }
    } catch (err) {
      console.error('Add to cart error', err);
    }
  });
});
</script>
{% endblock %}
